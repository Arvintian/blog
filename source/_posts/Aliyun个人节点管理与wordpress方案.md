---
title: Aliyun个人节点管理与wordpress方案
date: 2018-09-02 13:52:16
tags: 生命在于折腾
---

背景
--

做为一名后端开发，拥有一个带公网IP的个人节点折腾东西是再方便不过，所以很多同学都有买个人节点的经历，但是买了之后坚持一两个月就废了。个人经历废的原因是：没有充分利用，应用、数据懒得管理，每月花钱比充话费还多（2333）。 个人体验主要原因是自己在单节点上部署个人应用数据并不达到自己长期保存理想要求，为安全花多钱买多节点和存储，使用更不充分更不划算，所以一直纠结，有需求但又觉得不划算。简单讲，一个节点可用存储空间是云盘，自建数据库存储，应用产生的数据存储，不买其他存储服务的情况下都是这块云盘。如果这块云盘crash了？自己辛苦耕耘都白费！ 既然自己有需求，所以就花点时间，找个方案呗。 不能充分利用？先搭建个wordpress，自己坚持写下去了就值了。

Aliyun管理
--------

清单：

*   1G1U 40G ECS 59元/月
*   1M弹性IP 按量付费（目前几乎没流量不要钱）
*   oss存储包 华北2 40G 9元/年
*   oss存储包 全国 40G 9元/年
*   oss流量 按量付费（目前几乎没流量不要钱）

方案： 自建数据库，应用备份？ 这些存储直接使用的云盘，所以直接使用云盘的快照功能，设置自动快照策略自动快照。快照花费的地方是存储，阿里的oss存储包是抵快照存储的，所以买oss的存储包，购买策略是机器在华北2云盘大小40G，买一个华北2的买一个全国的最小40G存储包（因为一个区一个规格只能买一次）。逻辑是一次备份40G，在下次备份未成功之前上次备份不能删除，所以就是80G。因为阿里快照有快照链增量功能，所以实际设置策略保留近两次备份，存储目前使用20G不到。 图片，打包数据等静态文件存储、备份？ 搭建wordpress/网站我们肯定会上传图片、附件，个人电脑上的数据可能也放服务器上给同学朋友分享。这些数据是非常不建议直接放云盘的，云盘没多大，放多了还影响快照备份速度。ECS应该是仅做计算就好了，不要当存储。这些数据放oss就好，无限大管理还方便。值得注意，需要设置好oss访问策略，oss存储便宜但是流量贵（2333）。 应用部署运维？ 全部容器部署，存储卷映射到固定的数据目录，主机仅安装启动一个Nginx作为Ingress反向代理。 安全？ 安全组设置仅开放22、80、443端口，服务器仅可以通过密钥登录。

WordPress方案
-----------

MySQL数据库？ 自己写的东西要保留下去，数据就必须安全。先调研看了阿里的RDS，个人用没钱直接放弃，最划算是自建但要自己解决备份。上面讲到通过云盘快照来自动备份，个人数据一天内的丢失自己还是能重写出来的嘛，可以接受。 文章图片，附件？ 写文章引图片，上传直接存主机云盘不符合我们上面讲到的存储逻辑。这里有两个方案：一找图床网站，问题是免费的某一天关了怎么办？收费图床网站的和自己买七牛/又拍云/oss存储一个道理。二就是自己买存储自己托管。因为自己买的oss存储除了云盘快照还有很大空间，所以自己采用存oss方式。问题一，wordpress集成，图片附件直接上传oss？[采用这个插件解决](https://www.xiaomac.com/2016121895.html "采用这个插件")。问题二，oss存储便宜流量贵，防盗链？在阿里控制台设置文件访问控制，设置防盗链Referer。 Markdown支持？ 使用wordpress写东西一个很不爽的地方就是官方编辑器不支持markdown写起来很不舒服格式化老出问题。问题解决[采用这个插件](https://github.com/JaxsonWang/WP-Editor.md "采用这个插件")。

附图
--

*   容器部署

![](http://oss-blog.arvintian.cn/2018/09/2018-09-02-132933%E7%9A%84%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE.png?x-oss-process=image/resize,m_fill,w_1024,h_145)

*   对象存储

![](http://oss-blog.arvintian.cn/2018/09/2018-09-02-133140%E7%9A%84%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE.png?x-oss-process=image/resize,m_fill,w_1024,h_366)

*   写文章

![](http://oss-blog.arvintian.cn/2018/09/2018-09-02-133003%E7%9A%84%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE.png?x-oss-process=image/resize,m_fill,w_1024,h_491)

总结
--

这样下来，自己前期的部署运维工作做的差不多了，需要做的就是每月续费，好好坚持写文章。另外就是花这些钱买的这些计算资源远远还没充分利用，一定要利用好这台不停机还有公网IP的机器呀！ 最近在读老罗的书，生命不息，折腾不止！